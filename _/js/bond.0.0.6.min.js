/*bond.0.0.6.js | David Adalberth Andersen @ Stupid Studio | 2014-04-08*/!function(a){"use strict";function b(b){var c={visibility:{top:0,bottom:0,victimBody:!1},animation:{cssClass:"spotted",once:!1}};this.option=a.extend(!0,{},c,b||{}),this.report=!1,this.victims=[],this.forcedspying=!1,this.$window=a(window),this.$body=a("body"),this.scrollIncrement=0,this.minScrollIncrement=20,this.direction="none",this.height=this.$window.height(),this.scrollPosition=this.$window.scrollTop(),this.scrollStop=0,this.targetZone={start:this.scrollPosition,end:this.scrollPosition+this.height}}b.prototype={constructor:b,spyon:function(b){if(b.length>0){this.report&&console.log('Mr. Bond: "Reciving Misson Data"');var c,d=b.length,e=this;for(c=0;d>c;c++){var f=b[c];f.victim instanceof a||f.victim instanceof jQuery?f.victim.length>1?a.each(f.victim,function(a,b){e._addVictimToVictims(b,f.missionData,f)}):this._addVictimToVictims(f.victim[0],f.missionData,f):this._addVictimToVictims(f.victim,f.missionData,f)}}else this.report&&console.log('Mr. Bond: "This mission data contains no victims!"');return this},forcespy:function(a){void 0===a?(this._setScrollPosition(),this._setTargetZone(),this._calcVictimsPosition(),this._iterateOverVictims()):this._timedForceSpy(a)},start:function(){return this.victims.length>0?(this.report&&console.log('Mr. Bond: "Misson is a go, im spying on:"',this.victims),this._init()):this.report&&console.log('Mr. Bond: "I need victims to watch"'),this},_init:function(){this._watchForScroll(),this._handleScroll()},_timedForceSpy:function(a){this.forcedspying=!0;var b=this,c=0,d=(a+100)/100,e=setInterval(function(){c>d&&(b.forcedspying=!1,clearInterval(e)),b.forcespy(),c++},100)},_addVictimToVictims:function(b,c,d){void 0===this._addVictimToVictims.id&&(this._addVictimToVictims.id=-1),this._addVictimToVictims.id++;var e={};e.missionData=a.extend(!0,{},this.option,c||{}),e.$victim=a(b),e.height=e.$victim.height(),e.location=e.$victim.offset().top,e.locationAndBody=e.$victim.offset().top+e.height,e.name=e.$victim.attr("id")||e.$victim.attr("class")||e.victim,e.extra=d.extra||!1,e.id=this._addVictimToVictims.id,this.victims.push(e)},_calcVictimsPosition:function(){this.report&&console.log('Mr. Bond: "Searching for victims location"');var a,b=this.victims.length;for(a=0;b>a;a++){var c=this.victims[a];c.height=c.$victim.height(),c.location=c.$victim.offset().top,c.locationAndBody=c.$victim.offset().top+c.height}},_watchForScroll:function(){var a=this;this.$window.scroll(function(){a.forcedspying||a._handleScroll()}).resize(function(){a.height=a.$window.height(),a.forcedspying||(a._setTargetZone(),a._iterateOverVictims())})},_handleScroll:function(){this._setScrollPosition(),this._setTargetZone(),this._iterateOverVictims(),this._onScrollStop(),this._calcScrollIncrement()},_findDirection:function(a){this.direction=a[0]<a[1]||isNaN(a[1])?"down":"up"},_calcScrollIncrement:function(){void 0===this._calcScrollIncrement.increments&&(this._calcScrollIncrement.increments=[]),this._calcScrollIncrement.increments.push(this.targetZone.start),this._calcScrollIncrement.increments.length>2&&this._calcScrollIncrement.increments.shift(),this.scrollIncrement=Math.abs(this._calcScrollIncrement.increments[0]-this._calcScrollIncrement.increments[1]),(this.scrollIncrement<this.minScrollIncrement||isNaN(this.scrollIncrement))&&(this.scrollIncrement=this.minScrollIncrement),this._findDirection(this._calcScrollIncrement.increments)},_onScrollStop:function(){var a=this;this.scrollStop&&clearTimeout(this.scrollStop),this.scrollStop=setTimeout(function(){a._calcVictimsPosition(),a._iterateOverVictims()},100)},_setScrollPosition:function(){this.scrollPosition=this.$window.scrollTop(),this.scrollPosition<=0&&(this.scrollPosition=0)},_setTargetZone:function(){this.targetZone.start=this.scrollPosition,this.targetZone.end=this.scrollPosition+this.height},_iterateOverVictims:function(){var a,b=this.victims.length;for(a=0;b>a;a++){var c=this.victims[a],d=this.targetZone.start+this._getPadding(c,c.missionData.visibility.top),e=this.targetZone.end-this._getPadding(c,c.missionData.visibility.bottom);c.missionData.visibility.victimBody?this.height<c.height?this._findVictim(c,c.locationAndBody,c.location,this.targetZone.end,this.targetZone.start):(d-=0!==c.missionData.visibility.top&&c.missionData.visibility.top<1?c.height/2+this.scrollIncrement:this.scrollIncrement,e+=0!==c.missionData.visibility.bottom&&c.missionData.visibility.bottom<1?c.height/2+this.scrollIncrement:this.scrollIncrement,this._findVictim(c,c.location,c.locationAndBody,d,e)):this._findVictim(c,c.locationAndBody,c.location,d,e)}},_getPadding:function(a,b){return 1>b?this.height*b:this._checkPxBounds(a)?0:b},_checkPxBounds:function(a){var b=a.missionData.visibility.top,c=a.missionData.visibility.bottom,d=a.height,e=a.missionData.visibility.victimBody;return b+c>this.height||b+c+d>this.height&&e?!0:!1},_findVictim:function(a,b,c,d,e){b>d&&e>c?a.called&&void 0!==a.called||(this.report&&console.log('Mr. Bond: "Victim: [',a.name,'] is IN the kill zone"'),this._victimInScope(a),a.called=!0):(a.called&&a.locationAndBody<this.targetZone.start||a.called&&a.location>this.targetZone.end)&&(this.report&&console.log('Mr. Bond: "Victim: [',a.name,'] is OFF premises"'),this._vicimOutScope(a),a.called=!1)},_victimInScope:function(a){a.$victim.hasClass(a.missionData.animation.cssClass)||a.$victim.addClass(a.missionData.animation.cssClass),a.missionData.animation.once?a.missionData.animation.in&&!a.eleminated&&(a.missionData.animation.in(a),a.eleminated=!0):a.missionData.animation.in&&a.missionData.animation.in(a)},_vicimOutScope:function(a){a.$victim.hasClass(a.missionData.animation.cssClass)&&!a.missionData.animation.once&&a.$victim.removeClass(a.missionData.animation.cssClass),a.missionData.animation.out&&a.missionData.animation.out(a)}},window.Bond=b}(jQuery);